<html lang="ja"><head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Thermoelectric Paper JSON → Compact HTML Tables</title>
  <style>
    :root {
      --bg: #ffffff;
      --panel: #ffffff;
      --text: #111827;
      --muted: #6b7280;
      --border: #e5e7eb;
      --accent: #2563eb;
      --danger: #dc2626;
      --ok: #16a34a;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }
    html, body { height: 100%; }
    body { margin: 0; font: 13px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Noto Sans, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: var(--bg); color: var(--text); }
    header { position: sticky; top: 0; z-index: 20; background: linear-gradient(180deg, rgba(255,255,255,0.98), rgba(255,255,255,0.92));
      border-bottom: 1px solid var(--border); backdrop-filter: blur(6px); }
    .container { max-width: 1200px; margin: 0 auto; padding: 16px; }
    h1 { font-size: 18px; margin: 0; }
    .sub { color: var(--muted); font-size: 12px; }
    .controls { display: grid; grid-template-columns: 1fr; gap: 8px; margin-top: 12px; }
    textarea { width: 100%; min-height: 180px; resize: vertical; box-sizing: border-box;
      background: #ffffff; color: var(--text); border: 1px solid var(--border);
      border-radius: 8px; padding: 10px; font-family: var(--mono); font-size: 12px; }
    .btnrow { display: flex; gap: 8px; flex-wrap: wrap; }
    button { appearance: none; border: 1px solid var(--border); background: #ffffff; color: var(--text);
      padding: 8px 10px; font-size: 12px; border-radius: 8px; cursor: pointer;
      transition: transform .02s ease, background .15s ease, border-color .15s ease; }
    button:hover { background: #f3f4f6; border-color: #d1d5db; }
    button.primary { border-color: var(--accent); background: var(--accent); color: #ffffff; }
    button.primary:hover { background: #1d4ed8; }
    .ghost { background: transparent; }
    .grid { display: grid; grid-template-columns: 1fr; gap: 16px; margin-top: 16px; }
    .card { background: var(--panel); border: 1px solid var(--border); border-radius: 12px; padding: 12px; box-shadow: 0 2px 0 rgba(0,0,0,.2); }
    .card h2 { margin: 0 0 8px; font-size: 14px; }
    .meta { color: var(--muted); font-size: 12px; }
    .table-wrap { overflow: auto; border: 1px solid var(--border); border-radius: 10px; }
    table { border-collapse: collapse; width: 100%; min-width: 1100px; }
    thead th { position: sticky; top: 0; z-index: 1; background: #f8fafc; color: var(--muted);
      font-weight: 600; text-align: left; border-bottom: 1px solid var(--border); }
    th, td { padding: 4px 6px; border-bottom: 1px solid var(--border); vertical-align: top; }
    tbody tr:hover { background: #f9fafb; }
    .compact th, .compact td { padding: 3px 6px; font-size: 12px; }
    .kvt td:first-child { white-space: nowrap; color: var(--muted); width: 240px; }
    details { border: 1px dashed var(--border); border-radius: 8px; padding: 6px 8px; }
    details > summary { cursor: pointer; color: var(--accent); outline: none; }
    .pill { display: inline-block; padding: 2px 6px; border: 1px solid var(--border); border-radius: 999px; font-size: 11px; color: var(--muted); margin: 2px 4px 0 0; }
    .ok { color: var(--ok); }
    .bad { color: var(--danger); }
    .mono { font-family: var(--mono); }
    .muted { color: var(--muted); }
    .footer-note { color: var(--muted); font-size: 11px; margin-top: 8px; }
    .formula { font-family: var(--mono); white-space: pre-wrap; overflow-wrap: anywhere; line-height: 1.4; }
    .info-box { background: #f9fafb; border: 1px solid var(--border); border-radius: 8px; padding: 12px 16px; margin-bottom: 12px; }
    .info-box h3 { margin: 0 0 8px; font-size: 13px; font-weight: 600; color: var(--text); }
    .info-box p { margin: 4px 0; font-size: 12px; color: var(--muted); line-height: 1.5; }
    .info-box .external-btn { background: var(--accent); color: white; border: none; padding: 6px 12px; font-size: 12px; margin-top: 8px; }
    .info-box .external-btn:hover { background: #1d4ed8; }
    .step-label { display: inline-block; background: transparent; color: var(--accent); border: 1px solid var(--accent); padding: 2px 8px; border-radius: 4px; font-size: 11px; font-weight: 600; margin-right: 6px; }
    .step-section { margin-bottom: 16px; }
    .step-header { display: flex; align-items: center; margin-bottom: 8px; }
    .step-title { font-size: 14px; font-weight: 600; color: var(--text); }
  </style>
</head>
<body>
  <header>
    <div class="container">
      <h1>Thermoelectric Paper JSON → Compact HTML Tables</h1>
      
      <div class="step-section">
        <div class="step-header">
          <span class="step-label">Step 1</span>
          <span class="step-title">Generate JSON Data</span>
        </div>
        <div class="info-box">
          <p>To extract JSON data from thermoelectric material research papers, use our custom ChatGPT: "Sample Information Extractor (Thermoelectric)".</p>
          <button class="external-btn" onclick="window.open('https://chatgpt.com/g/g-68a6737fa61881919561c553e5aac277-sample-information-extractor-thermoelectric', '_blank')">
            Generate JSON with ChatGPT →
          </button>
        </div>
      </div>
      
      <div class="step-section">
        <div class="step-header">
          <span class="step-label">Step 2</span>
          <span class="step-title">Paste Your JSON and Render Tables</span>
        </div>
        <div class="sub">Paste your JSON (grain size in [m]; sintering density normalized with 1 = theoretical).</div>
      <div class="controls">
        <textarea id="json-input" placeholder="Paste JSON here..."></textarea>
        <div class="btnrow">
          <button class="primary" id="render-btn">Render Tables</button>
          <button class="ghost" id="load-sample">Load Minimal Sample</button>
          <button class="ghost" id="download-html">Download Current View</button>
        </div>
      </div>
    </div>
  </header>

  <main class="container">
    <div id="output" class="grid"></div>
  </main>

  <script>
    const el = (tag, attrs = {}, children = []) => {
      const node = document.createElement(tag);
      for (const [k, v] of Object.entries(attrs)) {
        if (k === 'class') node.className = v;
        else if (k === 'html') node.innerHTML = v;
        else if (k.startsWith('on') && typeof v === 'function') node.addEventListener(k.slice(2), v);
        else node.setAttribute(k, v);
      }
      for (const c of [].concat(children)) if (c !== null && c !== undefined) node.append(c.nodeType ? c : document.createTextNode(String(c)));
      return node;
    };
    const isEmpty = (v) => v === null || v === undefined || (typeof v === 'string' && v.trim() === '') || (Array.isArray(v) && v.length === 0) || (typeof v === 'object' && !Array.isArray(v) && Object.keys(v).length === 0);
    const sanitize = (txt) => {
      if (txt === null || txt === undefined) return '';
      if (typeof txt !== 'string') return txt;
      return txt.replace(/:contentReference\[oaicite:[^\]]*\]\{[^}]*\}/g, '');
    };
    const safe = (v) => {
      if (v === null || v === undefined) return '';
      if (typeof v === 'string') return sanitize(v);
      return v;
    };
    const fmtNum = (v) => (v === null || v === undefined || v === '') ? '' : (typeof v === 'number' ? v.toString() : v);

    function tableKV(obj, titleMap = {}) {
      const tbl = el('table', { class: 'compact kvt' });
      const thead = el('thead', {}, el('tr', {}, [el('th', {}, 'Field'), el('th', {}, 'Value')]));
      const tbody = el('tbody');
      tbl.append(thead, tbody);
      for (const [k, v] of Object.entries(obj || {})) {
        if (isEmpty(v)) continue;
        let valueNode;
        if (Array.isArray(v)) {
          valueNode = el('div', {}, v.map(x => el('span', { class: 'pill' }, safe(typeof x === 'string' ? sanitize(x) : x))));
        } else if (typeof v === 'object') {
          valueNode = tableKV(v);
        } else {
          const toText = (x) => (typeof x === 'string' ? sanitize(x) : String(x));
          valueNode = el('span', {}, toText(v));
        }
        tbody.append(el('tr', {}, [el('td', {}, titleMap[k] || k), el('td', {}, valueNode)]));
      }
      return tbl;
    }

    function renderMetadata(meta, root) {
      const card = el('div', { class: 'card' });
      card.append(el('h2', {}, 'Paper Metadata'));
      card.append(el('div', { class: 'table-wrap' }, tableKV(meta, {
        title: 'Title', doi: 'DOI', journal: 'Journal', year: 'Year', authors: 'Authors', url: 'URL', notes: 'Notes'
      })));
      root.append(card);
    }

    function renderScopeCheck(scope, root) {
      const card = el('div', { class: 'card' });
      card.append(el('h2', {}, 'Scope Check'));
      const view = {
        domain: safe(scope?.domain),
        is_original_research: scope?.is_original_research,
        is_review: scope?.is_review,
        is_experimental: scope?.is_experimental,
        is_theoretical: scope?.is_theoretical,
        purpose: safe(scope?.purpose),
        approach: safe(scope?.approach)
      };
      card.append(el('div', { class: 'table-wrap' }, tableKV(view)));
      root.append(card);
    }

    function axisTable(axes = []) {
      const tbl = el('table', { class: 'compact mono' });
      tbl.append(el('thead', {}, el('tr', {}, [
        el('th', {}, 'Axis'), el('th', {}, 'Quantity'), el('th', {}, 'Unit'), el('th', {}, 'Ref Ticks'), el('th', {}, 'Scale'), el('th', {}, '→ SI Conversion')
      ])));
      const tbody = el('tbody'); tbl.append(tbody);
      for (const ax of axes) {
        tbody.append(el('tr', {}, [
          el('td', {}, safe(ax.axis)),
          el('td', {}, safe(ax.quantity)),
          el('td', {}, safe(ax.unit)),
          el('td', {}, Array.isArray(ax.reference_ticks) ? ax.reference_ticks.join(', ') : safe(ax.reference_ticks)),
          el('td', {}, safe(ax.scale)),
          el('td', {}, safe(ax.conversion_to_SI))
        ]));
      }
      return el('div', { class: 'table-wrap' }, tbl);
    }

    function graphDetails(graphs = []) {
      if (!graphs || graphs.length === 0) return el('span', { class: 'muted' }, '—');
      const container = el('div');
      graphs.forEach((g, i) => {
        const d = el('details', {}, [
          el('summary', {}, `Graph ${i+1} — axes:${(g.axes||[]).length}`),
          axisTable(g.axes || []),
          !isEmpty(g.notes) ? el('div', { class: 'footer-note' }, `notes: ${g.notes}`) : null
        ]);
        container.append(d);
      });
      return container;
    }

    function renderFigures(figures = [], root) {
      const card = el('div', { class: 'card' });
      card.append(el('h2', {}, `Figures (${figures.length})`));
      const tbl = el('table', { class: 'compact' });
      tbl.append(el('thead', {}, el('tr', {}, [
        el('th', {}, 'Figure ID'),
        el('th', {}, 'Subfigure'),
        el('th', {}, 'Caption Summary'),
        el('th', {}, 'Graphs (#)'),
        el('th', {}, 'Graphs — Details')
      ])));
      const tbody = el('tbody'); tbl.append(tbody);

      const addRow = (figId, subId, cap, graphs) => {
        const count = graphs && graphs.length ? graphs.length : 0;
        tbody.append(el('tr', {}, [
          el('td', {}, figId || ''),
          el('td', {}, subId || ''),
          el('td', {}, cap || ''),
          el('td', {}, String(count)),
          el('td', {}, graphDetails(graphs))
        ]));
      };

      (figures || []).forEach(fig => {
        const figId = fig.figure_id || '';
        if (fig.graphs && fig.graphs.length) addRow(figId, '', safe(fig.caption_summary), fig.graphs);
        if (fig.subfigures && fig.subfigures.length) {
          fig.subfigures.forEach(sf => addRow(figId, sf.subfigure_id || '', safe(sf.caption_summary), sf.graphs || []));
        }
        if ((!fig.graphs || fig.graphs.length === 0) && (!fig.subfigures || fig.subfigures.length === 0)) addRow(figId, '', safe(fig.caption_summary), []);
      });

      card.append(el('div', { class: 'table-wrap' }, tbl));
      root.append(card);
    }

    function renderSamplesCommon(common = {}, root) {
      const card = el('div', { class: 'card' });
      card.append(el('h2', {}, 'Samples — Common Info'));
      const view = {
        morphology: safe(common.morphology),
        microstructure: {
          'sintering_density (normalized 0–1)': fmtNum(common?.microstructure?.sintering_density),
          grain_size: fmtNum(common?.microstructure?.grain_size),
          other: safe(common?.microstructure?.other)
        },
        synthesis: {
          method: safe(common?.synthesis?.method),
          equipment: safe(common?.synthesis?.equipment),
          conditions: safe(common?.synthesis?.conditions)
        },
        measurement: {
          properties_measured: (common?.measurement?.properties_measured || []).map(x => typeof x === 'string' ? sanitize(x) : x).join(', '),
          methods: safe(common?.measurement?.methods),
          equipment: safe(common?.measurement?.equipment),
          conditions: safe(common?.measurement?.conditions)
        },
        other_factors: safe(common.other_factors)
      };
      card.append(el('div', { class: 'table-wrap' }, tableKV(view)));
      root.append(card);
    }


    function formulaNode(text) {
      return el('div', { class: 'formula' }, safe(text));
    }

    function perSampleDetails(ss = {}) {
      if (isEmpty(ss)) return el('span', { class: 'muted' }, '—');
      const v = {
        morphology: safe(ss.morphology),
        microstructure: {
          sintering_density: fmtNum(ss?.microstructure?.sintering_density),
          grain_size: fmtNum(ss?.microstructure?.grain_size),
          other: safe(ss?.microstructure?.other)
        },
        synthesis: ss.synthesis || {},
        measurement: {
          properties_measured: (ss?.measurement?.properties_measured || []).map(x => typeof x === 'string' ? sanitize(x) : x).join(', '),
          methods: safe(ss?.measurement?.methods),
          equipment: safe(ss?.measurement?.equipment),
          conditions: safe(ss?.measurement?.conditions)
        },
        other_factors: safe(ss.other_factors)
      };
      return tableKV(v);
    }

    function renderSamples(samples = [], root) {
      const card = el('div', { class: 'card' });
      card.append(el('h2', {}, `Samples (${samples.length})`));
      const tbl = el('table', { class: 'compact' });
      tbl.append(el('thead', {}, el('tr', {}, [
        el('th', {}, 'Sample Name'),
        el('th', {}, 'Crystal Structure'),
        el('th', {}, 'Parent Formula'),
        el('th', {}, 'Parent (molar)'),
        el('th', {}, 'Starting Composition'),
        el('th', {}, 'Target Composition'),
        el('th', {}, 'Analyzed Composition'),
        el('th', {}, 'Molar Starting'),
        el('th', {}, 'Molar Target'),
        el('th', {}, 'Molar Analyzed'),
        el('th', {}, 'Appears In'),
        el('th', {}, 'Sample-specific?'),
        el('th', {}, 'Details')
      ])));
      const tbody = el('tbody'); tbl.append(tbody);

      (samples || []).forEach(s => {
        const comp = s.sample_composition || {};
        const mol = s.molar_composition || {};
        const hasSS = !isEmpty(s.sample_specific);
        const details = el('details', {}, [
          el('summary', {}, 'Show sample-specific fields'),
          el('div', { class: 'table-wrap' }, perSampleDetails(s.sample_specific || {}))
        ]);
        tbody.append(el('tr', {}, [
          el('td', {}, safe(s.sample_name)),
          el('td', {}, safe(s.crystal_structure)),
          el('td', {}, formulaNode(s.parent_composition?.formula_text)),
          el('td', {}, safe(s.parent_composition?.molar_composition)),
          el('td', {}, formulaNode(comp.starting_composition)),
          el('td', {}, formulaNode(comp.target_composition)),
          el('td', {}, formulaNode(comp.analyzed_composition)),
          el('td', {}, safe(mol.starting)),
          el('td', {}, safe(mol.target)),
          el('td', {}, safe(mol.analyzed)),
          el('td', {}, (s.appears_in || []).join(', ')),
          el('td', {}, hasSS ? el('span', { class: 'ok' }, 'Yes') : el('span', { class: 'muted' }, 'No')),
          el('td', {}, hasSS ? details : el('span', { class: 'muted' }, '—'))
        ]));
      });

      card.append(el('div', { class: 'table-wrap' }, tbl));
      root.append(card);
    }

    function renderTables(tables = [], root) {
      const card = el('div', { class: 'card' });
      card.append(el('h2', {}, `Tables (${tables.length})`));
      if (!tables || tables.length === 0) {
        card.append(el('div', { class: 'muted' }, 'No tables found.'));
        root.append(card); return;
      }
      tables.forEach((t, idx) => {
        const det = el('details', {}, [
          el('summary', {}, `${t.table_id || 'Table ' + (idx+1)} — ${t.caption_summary || ''}`)
        ]);
        if (t.headers && t.headers.length) {
          const tt = el('table', { class: 'compact' });
          const thead = el('thead', {}, el('tr', {}, t.headers.map(h => el('th', {}, safe(h)))));
          const tbody = el('tbody');
          tt.append(thead, tbody);
          (t.rows || []).forEach(r => {
            const row = Array.isArray(r) ? r : [];
            tbody.append(el('tr', {}, row.map(c => el('td', {}, safe(c)))));
          });
          det.append(el('div', { class: 'table-wrap' }, tt));
        } else {
          det.append(el('div', { class: 'table-wrap' }, tableKV({ headers: t.headers || [], rows: t.rows || [] })));
        }
        if (!isEmpty(t.notes)) det.append(el('div', { class: 'footer-note' }, `notes: ${t.notes}`));
        card.append(det);
      });
      root.append(card);
    }

    function renderProvenance(prov = {}, root) {
      const card = el('div', { class: 'card' });
      card.append(el('h2', {}, 'Provenance'));
      card.append(el('div', { class: 'table-wrap' }, tableKV(prov)));
      root.append(card);
    }

    function renderAll(data) {
      const out = document.getElementById('output');
      out.innerHTML = '';
      renderMetadata(data.paper_metadata || {}, out);
      renderScopeCheck(data.scope_check || {}, out);
      renderFigures(data.figures || [], out);
      renderTables(data.tables || [], out);
      renderSamplesCommon(data.samples_common || {}, out);
      renderSamples(data.samples || [], out);
      renderProvenance(data.provenance || {}, out);
    }

    const sampleData = {
      paper_metadata: { title: "", doi: "", journal: "", year: null, authors: [], url: "", notes: "" },
      scope_check: {
        domain: "",
        is_original_research: null,
        is_review: null,
        is_experimental: null,
        is_theoretical: null,
        purpose: "",
        approach: ""
      },
      figures: [],
      tables: [],
      samples_common: {
        morphology: "",
        microstructure: { sintering_density: null, grain_size: null, other: "" },
        synthesis: { method: "", equipment: "", conditions: "" },
        measurement: { properties_measured: [], methods: "", equipment: "", conditions: "" },
        other_factors: ""
      },
      samples: [],
      provenance: { extraction_method: "manual", annotator: "", date: "" }
    };

    document.getElementById('load-sample').onclick = () => {
      document.getElementById('json-input').value = JSON.stringify(sampleData, null, 2);
    };

    document.getElementById('render-btn').onclick = () => {
      const txt = document.getElementById('json-input').value.trim();
      let data;
      try {
        data = txt ? JSON.parse(txt) : sampleData;
      } catch (e) {
        alert('JSON parse error: ' + e.message);
        return;
      }
      renderAll(data);
      window.scrollTo({ top: document.querySelector('header').offsetHeight, behavior: 'smooth' });
    };

    document.getElementById('download-html').onclick = () => {
      const blob = new Blob([document.documentElement.outerHTML], { type: 'text/html;charset=utf-8' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'thermoelectric_json_tables.html'; a.click();
      URL.revokeObjectURL(url);
    };

    // Initialize textarea with skeleton
    document.getElementById('json-input').value = JSON.stringify(sampleData, null, 2);
  </script>


</body></html>
